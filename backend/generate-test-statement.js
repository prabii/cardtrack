/**
 * Script to generate a sample credit card statement PDF for testing
 * 
 * Usage: node generate-test-statement.js
 * 
 * This will create a sample-statement.pdf file in the backend directory
 */

const PDFDocument = require('pdfkit');
const fs = require('fs');
const path = require('path');

// Create a new PDF document
const doc = new PDFDocument({
  size: 'LETTER',
  margins: { top: 50, bottom: 50, left: 50, right: 50 }
});

// Output file path
const outputPath = path.join(__dirname, 'sample-statement.pdf');

// Create write stream
const stream = fs.createWriteStream(outputPath);

// Pipe PDF to file
doc.pipe(stream);

// Sample data
const bankName = 'Sample Bank';
const cardNumber = '**** **** **** 1234';
const statementMonth = 'November 2025';
const statementPeriod = 'November 1, 2025 - November 30, 2025';
const cardLimit = 10000;
const outstandingAmount = 2450.75;
const availableLimit = cardLimit - outstandingAmount;
const minimumPayment = 50.00;
const dueDate = 'December 15, 2025';

// Header
doc.fontSize(20).font('Helvetica-Bold').text(bankName, { align: 'center' });
doc.moveDown(0.5);
doc.fontSize(14).font('Helvetica').text('Credit Card Statement', { align: 'center' });
doc.moveDown(1);

// Card Information
doc.fontSize(12).font('Helvetica-Bold').text('Card Information:');
doc.font('Helvetica').text(`Card Number: ${cardNumber}`);
doc.text(`Statement Period: ${statementPeriod}`);
doc.text(`Statement Month: ${statementMonth}`);
doc.moveDown(1);

// Account Summary Box
doc.rect(50, doc.y, 500, 120).stroke();
doc.fontSize(14).font('Helvetica-Bold').text('Account Summary', 60, doc.y + 10);
doc.fontSize(11).font('Helvetica');
doc.text(`Credit Limit: $${cardLimit.toFixed(2)}`, 60, doc.y + 5);
doc.text(`Available Credit: $${availableLimit.toFixed(2)}`, 60, doc.y + 5);
doc.text(`Outstanding Balance: $${outstandingAmount.toFixed(2)}`, 60, doc.y + 5);
doc.text(`Minimum Payment Due: $${minimumPayment.toFixed(2)}`, 60, doc.y + 5);
doc.text(`Payment Due Date: ${dueDate}`, 60, doc.y + 5);
doc.moveDown(2);

// Transactions Header
doc.fontSize(14).font('Helvetica-Bold').text('Transaction Details');
doc.moveDown(0.5);

// Table Header
const tableTop = doc.y;
const itemHeight = 20;
const tableWidth = 500;
const col1 = 60;  // Date
const col2 = 120; // Description
const col3 = 350; // Amount

doc.fontSize(10).font('Helvetica-Bold');
doc.text('Date', col1, tableTop);
doc.text('Description', col2, tableTop);
doc.text('Amount', col3, tableTop);

// Draw line under header
doc.moveTo(col1, tableTop + 15).lineTo(col1 + tableWidth, tableTop + 15).stroke();

// Sample transactions
const transactions = [
  { date: '11/05/2025', description: 'AMAZON.COM PURCHASE', amount: 125.50 },
  { date: '11/08/2025', description: 'STARBUCKS COFFEE', amount: 5.75 },
  { date: '11/12/2025', description: 'WALMART SUPERSTORE', amount: 89.25 },
  { date: '11/15/2025', description: 'GAS STATION #1234', amount: 45.00 },
  { date: '11/18/2025', description: 'NETFLIX SUBSCRIPTION', amount: 15.99 },
  { date: '11/20/2025', description: 'RESTAURANT XYZ', amount: 67.50 },
  { date: '11/22/2025', description: 'UTILITY BILL PAYMENT', amount: 150.00 },
  { date: '11/25/2025', description: 'ONLINE SHOPPING', amount: 234.99 },
  { date: '11/28/2025', description: 'BANK FEE', amount: 5.00 },
  { date: '11/30/2025', description: 'CASH WITHDRAWAL ATM', amount: 200.00 }
];

let yPos = tableTop + 20;
doc.fontSize(9).font('Helvetica');

transactions.forEach((txn, index) => {
  doc.text(txn.date, col1, yPos);
  doc.text(txn.description.substring(0, 30), col2, yPos);
  doc.text(`$${txn.amount.toFixed(2)}`, col3, yPos);
  yPos += itemHeight;
  
  // Add page break if needed
  if (yPos > 700) {
    doc.addPage();
    yPos = 50;
  }
});

// Total
yPos += 10;
doc.moveTo(col1, yPos).lineTo(col1 + tableWidth, yPos).stroke();
yPos += 10;
doc.fontSize(11).font('Helvetica-Bold');
doc.text('Total Transactions:', col2, yPos);
doc.text(`$$${outstandingAmount.toFixed(2)}`, col3, yPos);

// Footer
doc.fontSize(8).font('Helvetica').fillColor('gray');
doc.text('This is a sample statement for testing purposes only.', 50, doc.page.height - 100, {
  align: 'center'
});
doc.text('Generated by CardTracker Pro Test Script', 50, doc.page.height - 85, {
  align: 'center'
});

// Finalize PDF
doc.end();

console.log('âœ… Sample statement PDF generated successfully!');
console.log(`ðŸ“„ File saved to: ${outputPath}`);
console.log('\nðŸ“‹ Sample Statement Details:');
console.log(`   Bank Name: ${bankName}`);
console.log(`   Card Number: ${cardNumber}`);
console.log(`   Last 4 Digits: 1234`);
console.log(`   Statement Month: ${statementMonth}`);
console.log(`   Statement Period: ${statementPeriod}`);
console.log(`   Card Limit: $${cardLimit.toFixed(2)}`);
console.log(`   Outstanding Amount: $${outstandingAmount.toFixed(2)}`);
console.log(`   Available Limit: $${availableLimit.toFixed(2)}`);
console.log(`   Minimum Payment: $${minimumPayment.toFixed(2)}`);
console.log(`   Due Date: ${dueDate}`);
console.log(`   Total Transactions: ${transactions.length}`);
console.log('\nðŸ’¡ You can now upload this PDF using the statement upload form!');

